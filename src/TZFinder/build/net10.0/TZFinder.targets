<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>

    <TimeZoneData Condition="'$(TimeZoneData)' == ''">Medium</TimeZoneData>
    <TimeZoneItem Condition="'$(TimeZoneItem)' == ''">Content</TimeZoneItem>

    <_TimeZoneSourceFile Condition="'$(TimeZoneData)' == 'Small'">20_5000_NoEtc_TimeZoneData.bin</_TimeZoneSourceFile>
    <_TimeZoneSourceFile Condition="'$(TimeZoneData)' == 'Medium'">25_600_NoEtc_TimeZoneData.bin</_TimeZoneSourceFile>
    <_TimeZoneSourceFile Condition="'$(TimeZoneData)' == 'Large'">30_152_NoEtc_TimeZoneData.bin</_TimeZoneSourceFile>

  </PropertyGroup>

  <!-- 
  Only add the data file if used in an app. UWP Native cannot handle duplicates 
  from transitive packages.
  -->
  <ItemGroup Condition="'$(_TimeZoneSourceFile)' != '' and (
                        '$(OutputType)' == 'Exe' or 
                        '$(OutputType)' == 'WinExe' or 
                        '$(OutputType)' == 'AppContainerExe' or
                        '$(AndroidApplication)' == 'true')">

    <Content Condition="'$(TimeZoneItem)' == 'Content'"
             Include="$(MSBuildThisFileDirectory)..\..\data\$(_TimeZoneSourceFile)"
             Link="TimeZoneData.bin"
             CopyToOutputDirectory="Always"
             SkipUnchangedFilesOnCopyAlways="true"
             Visible="false" />

    <EmbeddedResource Condition="'$(TimeZoneItem)' == 'EmbeddedResource'"
                      Include="$(MSBuildThisFileDirectory)..\..\data\$(_TimeZoneSourceFile)"
                      Link="$(TimeZoneDirectory)TimeZoneData.bin"
                      LogicalName="TZFinder.TimeZoneData.bin"/>

  </ItemGroup>

  <PropertyGroup>
    <BuildDependsOn>
      CheckTimeZoneData;
      $(BuildDependsOn)
    </BuildDependsOn>
  </PropertyGroup>

  <Target Name="CheckTimeZoneData">
    <Error Text="Unknown TimeZoneData '$(TimeZoneData)'"
           Condition="'$(TimeZoneData)' != 'Small' and '$(TimeZoneData)' != 'Medium' and '$(TimeZoneData)' != 'Large' and '$(TimeZoneData)' != 'None'" />
    <Error Text="Unknown TimeZoneItem '$(TimeZoneItem)'"
           Condition = "'$(TimeZoneItem)' != 'Content' and '$(TimeZoneItem)' != 'EmbeddedResource'" />
  </Target>

</Project>